grammar hierarchicalStructure
  # TODO: coverpage
  # TODO: preface
  # TODO: preamble
  # TODO: conclusions

  root              <- indent body dedent <Root>
  
  body              <- hier_element* <Body>

  # hier elements

  hier_element      <- hier_element_name heading:hier_element_heading? eol
                       indent
                       subheading:subheading?
                       children:(hier_element / block_element)*
                       dedent <HierElement>

  hier_element_name <- ('CHAPTER' / 'PARA' / 'PART' / 'SUBPART' / 'SECTION' / 'SUBSECTION')

                        # num - heading
                        # - heading
                        # num
                        # TODO: maybe better to make the heading the default?
                        #   eg: heading
                        #       num -
                        #       num - heading
  hier_element_heading <- space num:[^\n-]* heading:('-' space content:inline*)? <HierElementHeading>

  subheading        <- 'SUBHEADING' space content:inline+ eol <Heading>

  # block elements

  block_element     <- !dedent content:(table / line) eol <Block>

                     # TODO
  table             <- 'TABLE' <Table>

  line              <- inline+ <Line>
  
  # inline and marker elements

  inline            <- inline_marker / [^\n] <Inline>

  inline_marker     <- bold / image / italics / remark / ref

  # inlines

                     # **foo**
  bold              <- '**' content:(!'**' inline)+ '**' <Bold>

                     # images like markdown
                     # eg. ![title text](image url)
                     #
                     # the title text is optional, but the enclosing square brackets aren't
  image             <- '![' content:(!'](' [^\n])* '](' href:([^)\n]+) ')' <Image>

                     # //foo//
  italics           <- '//' content:(!'//' inline)+ '//' <Italics>

                     # [[remark]]
  remark            <- '[[' content:(!']]' inline)+ ']]' <Remark>

                     # [text](href)
  ref               <- '[' content:(!'](' [^\n])* '](' href:[^)\n]* ')' <Ref>

  # terminals

  eol               <- newline empty_line*

  empty_line        <- space? newline

  space             <- ' '+

  newline           <- "\n"

  indent            <- '{' eol

  dedent            <- '}' eol
